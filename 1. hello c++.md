# 课程介绍

大家好，这门课程是关于c++的。

c++有广泛的应用场景，尤其是对性能要求比较高的场景如搜索，广告，推荐和游戏引擎，c++基本是首选的编程语言。

c++是功能非常强大，支持函数，类，模板等，新的标准还支持线程，协程等非常实用的功能。

同时c++也是比较复杂的编程语言，尤其是为了写出更高效的代码，需要了解它底层的一些实现，如内存部局，虚函数等。

这门课力争给大家比较全面地展示c++，同时也注重深度和实战：在详细介绍c++的同时，还在课程中穿插了“经验之谈”，“高级话题”和“实战”，
并且在最后一章和实现一个简单的搜索引擎。希望这种既有理论又有实战，既学知识又了解工业界的课程方式能让大家快速掌握c++，并早日成为
优秀的c++程序员。

本课程适合零基本但希望从事c++编程的朋友。另外本课程是基于linux编程环境，主要使用的工具有vim，g++和gdb，如果你比较熟悉其它环境如windows和visual studio，应该也没有问题，因为我们是讲c++，除了编程工具外不会涉及太多环境的问题。

# hello c++

本章以一个简单的c++例子为引，简单介绍编程环境和如何调试。

## vim
vim是一款功能强大的编辑器，配置得当的话可以极大提高编程效率。windows，linux和macos下都有相应vim版本，可以搜索相关教程自行安装，建议安装最新版本。

下面以macos为例讲解。

#### 在终端打开vim
首先cd到相应的工作目录，然后输入vim。也可以从vim直接打开文件。

#### 打开&&保存文件&&退出
":e"

":w"

":q"

":wq"

#### 两种模式：插入模式和普通模式：
按下“ESC”后进入普通模式，只能浏览不能编辑；按下“i”后进入插入模式可以编辑。

#### 浏览
在普通模式下试着分别按下“h”,"j","k","l"，看看效果。

#### 输入
普通模式下，“shift+i”：在行首开始输入，"shift+a"：在行尾开始输入。

#### 搜索
"/any_thing"，然后回车

#### 附上vimrc

## g++
linux下编程c++代码使用的编译器是g++，如果没有的话可以按网上教程安装一下。

#### 编译命令
g++编译代码的命令很简单，在控制台下输入g++和c++代码的文件名即可，如：

g++ my_cpp_file.cc

其中my_cpp_file.cc是一个c++代码文件，后缀“.cc”表示是c++类型的文件。也有的人习惯用".cpp"代替".cc"，也是可以的。

#### 常用选项
g++有很多选项，在编译时加上后可实现相应功能。下面简单介绍一些常用选项：

-g: 在编译生成的可执行文件中保留调试信息，供调试时使用

-O: 编译优化级别，后面可以追加数字0～3，数值越大表示优化级别越高

-I: 指定头文件位置。c++的代码文件可以简单分两类，一个是上面的".cc"，另外一种是头文件，以“.h”结尾。
编译时需要在命令中指定这两种文件。头文件一般集中放在一个文件夹下，"-I"就是用来指定文件夹的位置，这样编译器就能
找到所有这些文件，从而正常编译。

-L&&-l: 库的位置和名字。c++语言有很多现成的库，如linux环境下的多线程库pthread。如果在代码中使用的这些库，就需
要在编译命令中指定这些库的名字。另外这些库不一定放在操作系统的标准位置，那么g++就找不到，又或者是从网上下载或
自己生成一些库，这时就需要指定库所在的位置，以便g++能够找到。-L和-l就是分别告诉g++这些库的位置和名字。

-o: 指定可执行文件名字。默认生成的可执行文件名字是“a.out”，可以通过这个选项更改。o表示“output”。

## 一个最简单的c++程序
下面用一个非常非常简单的程序展示一下c++的样子，让大家有个初步印象。这个代码只是简单地打印“”hello,c++"。
但麻雀虽小，五脏俱全，我们仍然可以通过这一小段代码了解c++的很多知识。

#### 输入代码并保存
1. 启动vim，创建并打开文件my_hello_cpp.cc，命令如下：
   "vim my_hello_cpp.cc"
2. 然后输入以下内容：
```
#include <iostream>
using namespace std;

int main() {
    cout << "hello,c++" << endl;
    return 0;
}
```
3. 用":wq"保存并关闭文件。

#### 编译运行
4. 使用如下编译命令：
   g++ my_hello_cpp.cc

5. 用"ls"查看目录下，应该有新生成可执行文件a.out

6. 运行这个文件：
   ./a.out

如果一切正常的话会打印出来“hello,c++"。

#### 解释一下这段代码
- include <iostream>
  前面提到过c++的头文件，一般把类定义和公共函数声明放到头文件，哪个地方要用的时候再包含进来，
  这样就可以重复使用了。这里，iostream是c++标准里的输入输出头文件，使用include就表示这段代码
  要用输入输出，所以要把iostream包含进来。
  这行也可以写成现在这样：

  include "iostream"

  但这样性能会稍差一些，原因是用“<>”时编译器会先从操作系统文件找这个头文件，而用“""”时会优先从用户指定位置开始查找。

- using namespace std
  namespace是c++一个关键字，表示名字空间。所谓空间就是把代码分割开，这样即使在两个空间有相同的名字编译器也不会报错，后面我们会详细说这个。
  具体到这行，就是表示下面的代码要使用std这个名字空间里的所有定义和声名（这不个好作法，但作为例子没问题）。

- int
  interger的简写，这个表示main函数运行结束后会返回一个int类型的数值。

- main
  c++代码必须有一个名字为main的函数，这是操作系统执行这段代码的入口函数。没有这个函数编译器会报错。

- 括号{}
  在c++里，函数里的内容必须放到一对“{}”括号里。

- cout && endl
  这两个都是来自于名字空间std，cout用于输出内容，endl用于换行，即光标移到下一行。
  
- return 0
  表示现在要结束函数的运行，并返回一个0。
  后面可以看到，return也可以不返回任何值。

- 分号“;”
  分号表示一条代码语句的结束，也是必须的。后面会详细讲。

## 添加注释
在代码的关键位置添加注释是个好习惯，这样方便别人理解和维护。c++有两种添加注释的方法：
- 方法1
```
#include <iostream>
using namespace std;

/*这是一行注释*/
int main() {
    cout << "hello,c++" << endl;
    return 0;
}
```

- 方法2
```
#include <iostream>
using namespace std;
// 这是一行注释
int main() {
    cout << "hello,c++" << endl;
    return 0;
}
```

## gdb && cgdb
写程序难免遇到问题，这时候就需要调试代码。linux下的调试工具是gdb和cgdb，后者可以分屏跟踪显示代码，能提高效率，其它方面和gdb是一样的。
这里简单介绍gdb的功能。

#### 两种启动方式
有两种启动的方式：

- 1. gdb + 可执行文件名，如："cgdb + ./a.out"
- 2. 先启动cgdb，再通过“file”命令加载可执行文件

在启动进入gdb后，输入"run"或者“r”并回车，就可以开始调试了。

#### 设置断点
调试时经常打断点，程序执行到这些位置会自动停下来。gdb中，使用“break”或者“b”命令可以设置断点，格式为“break 文件名:行号”。
通过"info break"可以查看所有断点信息，通过“del 断点编号”可以删除断点。
此外还可以设置条件断点，即满足条件时才让程序停下来。

#### 执行下一步
在调试时，一般会一行一行跟踪程序执行，让程序执行下一行的命令是“next”或者“n”。

#### 继续执行
有时程序当前运行到的位置距离断点位置比较远，如果不停输入“next”就比较麻烦，这里可以直接输入“continue”或者“c”，让程序直接
运行到断点停下。

#### 查看调用栈桢
当想查看当前的调用栈时，可以输入“backtrace”或者“bt”，就能输出从main到当前函数所调用的一串函数名和参数。
调用栈前有编号，通过“frame 编号”或者“f 编号”可以切换到相应的栈桢进一步调试。

## 实战：初试gdb

#### 使用-g选项重新编译
g++ -g my_hello_cpp.cc

#### 启动
cgdb ./a.out

#### 在main开始处设置断点
break my_hello_cpp.cc:4

#### 开始调试
r

#### 查看调用栈桢 && n && c
bt

c
